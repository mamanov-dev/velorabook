'use client';

import React, { createContext, useContext, useState, ReactNode } from 'react';

// Типы для книги
export interface BookChapter {
  number: number;
  title: string;
  content: string;
  epigraph?: string;
}

export interface GeneratedBook {
  title: string;
  chapters: BookChapter[];
  totalChapters: number;
  estimatedReadTime: number;
  author?: string;
  dedicatedTo?: string;
  bookType?: string;
  createdAt?: string;
  images?: BookImage[]; // Добавляем изображения
  metadata?: {
    bookType: string;
    generatedAt: string;
    wordCount: number;
    imagesCount?: number;
    imageAnalysis?: string[];
  };
}

export interface BookImage {
  url: string;
  caption?: string;
  description?: string;
  originalName?: string;
  size?: number;
}

// Интерфейс контекста
interface BookContextType {
  currentBook: GeneratedBook | null;
  setCurrentBook: (book: GeneratedBook | null) => void;
  isBookLoading: boolean;
  setIsBookLoading: (loading: boolean) => void;
  saveBook: (book: GeneratedBook) => void;
  clearBook: () => void;
  hasBook: boolean;
}

// Создаем контекст
const BookContext = createContext<BookContextType | undefined>(undefined);

// Провайдер контекста
export function BookProvider({ children }: { children: ReactNode }) {
  const [currentBook, setCurrentBook] = useState<GeneratedBook | null>(null);
  const [isBookLoading, setIsBookLoading] = useState(false);

  // Функция сохранения книги
  const saveBook = (book: GeneratedBook) => {
    const bookWithMetadata = {
      ...book,
      createdAt: new Date().toISOString(),
    };
    setCurrentBook(bookWithMetadata);
  };

  // Функция очистки книги
  const clearBook = () => {
    setCurrentBook(null);
  };

  // Проверка наличия книги
  const hasBook = currentBook !== null;

  const value: BookContextType = {
    currentBook,
    setCurrentBook,
    isBookLoading,
    setIsBookLoading,
    saveBook,
    clearBook,
    hasBook,
  };

  return (
    <BookContext.Provider value={value}>
      {children}
    </BookContext.Provider>
  );
}

// Хук для использования контекста
export function useBook() {
  const context = useContext(BookContext);
  if (context === undefined) {
    throw new Error('useBook must be used within a BookProvider');
  }
  return context;
}

// Демо-книга для тестирования
export const sampleBook: GeneratedBook = {
  title: "Демо Книга VeloraBook",
  chapters: [
    {
      number: 1,
      title: "Добро пожаловать в VeloraBook",
      content: `Добро пожаловать в VeloraBook! Это демонстрационная книга, созданная для показа возможностей нашей платформы.

Наша система использует искусственный интеллект для создания персонализированных книг на основе ваших ответов и загруженных фотографий. Каждая книга уникальна и создается специально для вас.

Когда вы загружаете фотографии, наш ИИ анализирует их содержимое и органично включает описания в повествование, создавая более живую и персональную историю.

Чтобы создать свою собственную книгу, перейдите на страницу создания и ответьте на несколько простых вопросов. ИИ проанализирует ваши ответы и создаст красивую персональную историю.

Это лишь начало вашего путешествия в мир персонализированной литературы! Каждая книга создается с любовью и вниманием к деталям.

Мы используем самые современные технологии искусственного интеллекта, чтобы превратить ваши воспоминания в настоящее литературное произведение. Будь то романтическая история, семейная хроника или книга о дружбе - каждая история особенная.

Попробуйте создать свою книгу прямо сейчас!`
    },
    {
      number: 2,
      title: "Возможности нашей платформы",
      content: `VeloraBook предлагает несколько типов персональных книг для разных случаев жизни.

**Романтические книги** - идеальны для создания истории ваших отношений. ИИ поможет вам рассказать о знакомстве, первых свиданиях, особенных моментах и планах на будущее. Загруженные фотографии помогут воссоздать атмосферу ваших самых ярких моментов. Каждая романтическая книга содержит 6-7 глав, охватывающих всю историю ваших отношений от первой встречи до планов на будущее.

**Семейные хроники** - сохраните историю вашей семьи для будущих поколений. Традиции, воспоминания, семейные ценности - все это войдет в вашу персональную книгу. Семейные фотографии добавят теплоты и подлинности каждой странице. Эти книги особенно ценны как подарок для старших членов семьи или как наследие для детей.

**Книги дружбы** - отпразднуйте особенные отношения с лучшими друзьями. Веселые истории, совместные приключения и теплые воспоминания оживут благодаря вашим совместным фотографиям.

**Детские книги** - создайте особенную историю о вашем ребенке, от рождения до текущего момента. Эти книги станут прекрасным подарком на день рождения или просто способом зафиксировать важные моменты детства.

**Книги путешествий** - увековечьте ваши самые яркие приключения и открытия в красивой повествовательной форме.

Каждая книга оформляется в красивом дизайне и может быть напечатана на качественной бумаге. Изображения интегрируются в повествование, создавая уникальную фотокнигу с персональной историей.`
    },
    {
      number: 3,
      title: "Технологии создания книг",
      content: `За созданием каждой книги VeloraBook стоят передовые технологии искусственного интеллекта.

Мы используем модель GPT-4, которая способна создавать эмоционально глубокие и литературно качественные тексты. ИИ анализирует ваши ответы на детальные вопросы и создает связное повествование, которое отражает уникальность вашей истории.

Особое внимание уделяется анализу загруженных фотографий. Система способна "видеть" изображения и понимать их контекст, что позволяет органично включать описания важных моментов в текст книги.

Каждая книга создается индивидуально - нет шаблонов или заготовок. ИИ учитывает тип отношений, характер событий, эмоциональную окраску ваших ответов и создает уникальное произведение.

Процесс генерации занимает от 2 до 3 минут, в зависимости от сложности и количества материала. За это время система:
- Анализирует все ваши ответы
- Определяет ключевые темы и эмоции
- Создает структуру повествования
- Пишет каждую главу с учетом общей логики
- Интегрирует описания фотографий

Результат - полноценная персональная книга объемом 4000-7000 слов, которая читается как настоящее литературное произведение.`
    },
    {
      number: 4,
      title: "Создайте свою уникальную историю",
      content: `Готовы создать свою уникальную книгу? Процесс простой, но результат - поразительный.

**Шаг 1: Выберите тип книги**
Определитесь, какую историю хотите рассказать. Романтическую историю для партнера? Семейную хронику для детей? Книгу дружбы для лучшего друга? Или может быть книгу о путешествии?

**Шаг 2: Ответьте на вопросы**
Каждый тип книги содержит 15-27 тщательно подобранных вопросов. Они помогают раскрыть эмоциональную глубину вашей истории. Чем подробнее ваши ответы, тем более живой и интересной получится книга.

**Шаг 3: Загрузите фотографии**
Добавьте до 8 ваших самых дорогих фотографий. ИИ проанализирует их и включит в повествование, создавая яркие описания запечатленных моментов.

**Шаг 4: Получите готовую книгу**
Через несколько минут вы получите полноценную персональную книгу с красивым оформлением, которую можно читать онлайн или распечатать.

ИИ создаст для вас красивую, эмоциональную историю, которая станет прекрасным подарком или семейной реликвией. Современная технология позволяет превратить обычные воспоминания в настоящее литературное произведение.

Ваши изображения автоматически оптимизируются для лучшего качества и производительности, а система поддерживает все популярные форматы: JPEG, PNG, WebP.

Начните создание вашей книги прямо сейчас и удивите близких уникальным подарком! Каждая история заслуживает быть рассказанной красиво.`
    }
  ],
  totalChapters: 4,
  estimatedReadTime: 12,
  author: "VeloraBook AI",
  dedicatedTo: "Всем, кто ценит персональные истории",
  bookType: "demo",
  createdAt: new Date().toISOString(),
  images: [
    {
      url: "https://images.unsplash.com/photo-1516738901171-8eb4fc13bd20?w=600&h=400&fit=crop",
      caption: "Пример романтической фотографии",
      description: "Так выглядят изображения в романтических книгах - нежные моменты, запечатленные навсегда"
    },
    {
      url: "https://images.unsplash.com/photo-1511895426328-dc8714191300?w=600&h=400&fit=crop",
      caption: "Семейные моменты",
      description: "Семейные фотографии помогают создать теплую атмосферу и сохранить важные воспоминания"
    },
    {
      url: "https://images.unsplash.com/photo-1529390079861-591de354faf5?w=600&h=400&fit=crop",
      caption: "Дружеские приключения",
      description: "Совместные фотографии с друзьями добавляют искренности и радости в повествование"
    }
  ],
  metadata: {
    bookType: "demo",
    generatedAt: new Date().toISOString(),
    wordCount: 1200,
    imagesCount: 3,
    imageAnalysis: [
      "Романтическая атмосфера с мягким освещением",
      "Семейный уют и теплота отношений", 
      "Радость и веселье дружеского общения"
    ]
  }
};